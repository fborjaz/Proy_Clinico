<!-- Modal Agregar Paciente con diseño médico profesional -->
<div id="modal-agregar-paciente" class="fixed inset-0 z-50 hidden overflow-y-auto bg-gray-900/50 backdrop-blur-sm">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
        <!-- Background overlay -->
        <div class="fixed inset-0 transition-opacity bg-gray-900/75 backdrop-blur-sm" aria-hidden="true"></div>

        <!-- Contenido del Modal -->
        <div class="inline-block w-full max-w-5xl px-8 py-8 my-8 overflow-hidden text-left align-middle transition-all transform bg-white dark:bg-gray-800 shadow-2xl rounded-3xl border border-gray-200 dark:border-gray-700 relative">
            <!-- Medical pattern background -->
            <div class="absolute inset-0 opacity-5 dark:opacity-10">
                <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <pattern id="medical-cross-modal" x="0" y="0" width="60" height="60" patternUnits="userSpaceOnUse">
                            <path d="M25 15h10v10h10v10h-10v10h-10v-10h-10v-10h10z" fill="currentColor" opacity="0.1"/>
                        </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#medical-cross-modal)" class="text-blue-500"/>
                </svg>
            </div>

            <!-- Header del Modal -->
            <div class="relative z-10 flex items-center justify-between mb-8 pb-6 border-b-2 border-gradient-to-r from-blue-200 to-green-200 dark:from-blue-700 dark:to-green-700">
                <div class="flex items-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center mr-6 shadow-lg border-2 border-white dark:border-gray-600">
                        <i class="fas fa-user-plus text-2xl text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-stethoscope text-blue-600 dark:text-blue-400 mr-3"></i>
                            Agregar Nuevo Paciente
                        </h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">Complete la información médica del paciente</p>
                    </div>
                </div>
                <button onclick="cerrarModalPaciente()" 
                        class="p-3 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-all duration-200 bg-gray-100 dark:bg-gray-700 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transform hover:scale-110">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <!-- Formulario con Acordeón -->
            <form id="form-nuevo-paciente" class="relative z-10 space-y-8">
                <!-- Acordeón Datos Personales -->
                <div class="border-2 border-blue-200 dark:border-blue-700 rounded-2xl overflow-hidden shadow-lg bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/50 dark:to-indigo-900/50">
                    <button type="button" onclick="toggleAccordion('datos-personales')" 
                            class="w-full px-8 py-6 text-left bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 flex items-center justify-between transform hover:scale-[1.02]">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4 shadow-lg">
                                <i class="fas fa-user-md text-xl text-white"></i>
                            </div>
                            <span class="text-xl font-bold text-white">Datos Personales</span>
                        </div>
                        <i id="icon-datos-personales" class="fas fa-chevron-down text-xl text-white transform transition-transform duration-300"></i>
                    </button>

                    <div id="content-datos-personales" class="px-8 py-8 bg-white dark:bg-gray-800">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Nombres -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-signature text-blue-500 mr-2"></i>
                                    Nombres *
                                </label>
                                <input type="text" id="nombres" name="nombres" required 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="Ingrese los nombres">
                            </div>

                            <!-- Apellidos -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-signature text-blue-500 mr-2"></i>
                                    Apellidos *
                                </label>
                                <input type="text" id="apellidos" name="apellidos" required 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="Ingrese los apellidos">
                            </div>

                            <!-- Cédula Ecuatoriana -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-id-card text-green-500 mr-2"></i>
                                    Cédula Ecuatoriana *
                                </label>
                                <input type="text" id="cedula_ecuatoriana" name="cedula_ecuatoriana" required maxlength="10" pattern="[0-9]{10}" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="1234567890">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Ingrese el número de cédula sin espacios ni guiones.
                                </p>
                            </div>

                            <!-- DNI Internacional -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-passport text-purple-500 mr-2"></i>
                                    DNI Internacional
                                </label>
                                <input type="text" id="dni" name="dni" maxlength="30" pattern="[A-Za-z0-9\-\. ]{5,30}" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="Pasaporte, DNI, CURP, etc.">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                    <i class="fas fa-globe mr-1"></i>
                                    Pasaporte, DNI, CURP u otro documento válido internacionalmente.
                                </p>
                            </div>

                            <!-- Fecha de Nacimiento -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-birthday-cake text-pink-500 mr-2"></i>
                                    Fecha de Nacimiento *
                                </label>
                                <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg">
                            </div>

                            <!-- Teléfono -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-phone text-green-500 mr-2"></i>
                                    Teléfono(s) *
                                </label>
                                <input type="text" id="telefono" name="telefono" required maxlength="50" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="+593 999 123 456">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Puede ingresar uno o más números separados por coma.
                                </p>
                            </div>

                            <!-- Email -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-envelope text-blue-500 mr-2"></i>
                                    Correo Electrónico
                                </label>
                                <input type="email" id="email" name="email" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="ejemplo@correo.com">
                            </div>

                            <!-- Sexo -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-venus-mars text-purple-500 mr-2"></i>
                                    Sexo *
                                </label>
                                <select id="sexo" name="sexo" required 
                                        class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg">
                                    <option value="">Seleccione...</option>
                                    <option value="MASCULINO">Masculino</option>
                                    <option value="FEMENINO">Femenino</option>
                                </select>
                            </div>

                            <!-- Estado Civil -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-heart text-red-500 mr-2"></i>
                                    Estado Civil *
                                </label>
                                <select id="estado_civil" name="estado_civil" required 
                                        class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg">
                                    <option value="">Seleccione...</option>
                                    <option value="SOLTERO">Soltero/a</option>
                                    <option value="CASADO">Casado/a</option>
                                    <option value="DIVORCIADO">Divorciado/a</option>
                                    <option value="VIUDO">Viudo/a</option>
                                    <option value="UNION_LIBRE">Unión Libre</option>
                                </select>
                            </div>

                            <!-- Tipo de Sangre -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-tint text-red-600 mr-2"></i>
                                    Tipo de Sangre
                                </label>
                                <select id="tipo_sangre" name="tipo_sangre" 
                                        class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg">
                                    <option value="">Seleccione...</option>
                                    <option value="O+">O+</option>
                                    <option value="O-">O-</option>
                                    <option value="A+">A+</option>
                                    <option value="A-">A-</option>
                                    <option value="B+">B+</option>
                                    <option value="B-">B-</option>
                                    <option value="AB+">AB+</option>
                                    <option value="AB-">AB-</option>
                                </select>
                            </div>
                        </div>

                        <!-- Dirección -->
                        <div class="mt-8 space-y-2">
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                <i class="fas fa-map-marker-alt text-orange-500 mr-2"></i>
                                Dirección Domiciliaria *
                            </label>
                            <input type="text" id="direccion" name="direccion" required maxlength="255" 
                                   class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                   placeholder="Ingrese la dirección completa">
                        </div>

                        <!-- Coordenadas Geográficas -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-globe-americas text-blue-500 mr-2"></i>
                                    Latitud
                                </label>
                                <input type="number" id="latitud" name="latitud" step="0.000001" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="Ej: -2.170998">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Coordenada geográfica (opcional).
                                </p>
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-globe-americas text-green-500 mr-2"></i>
                                    Longitud
                                </label>
                                <input type="number" id="longitud" name="longitud" step="0.000001" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="Ej: -79.922359">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Coordenada geográfica (opcional).
                                </p>
                            </div>
                        </div>

                        <!-- Foto -->
                        <div class="mt-8 space-y-2">
                            <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                <i class="fas fa-camera text-purple-500 mr-2"></i>
                                Foto del Paciente
                            </label>
                            <input type="file" id="foto" name="foto" accept="image/*" 
                                   class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                <i class="fas fa-info-circle mr-1"></i>
                                Imagen de perfil del paciente (opcional).
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Acordeón Historia Clínica -->
                <div class="border-2 border-green-200 dark:border-green-700 rounded-2xl overflow-hidden shadow-lg bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/50 dark:to-emerald-900/50">
                    <button type="button" onclick="toggleAccordion('historia-clinica')" 
                            class="w-full px-8 py-6 text-left bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition-all duration-300 flex items-center justify-between transform hover:scale-[1.02]">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mr-4 shadow-lg">
                                <i class="fas fa-file-medical text-xl text-white"></i>
                            </div>
                            <span class="text-xl font-bold text-white">Historia Clínica</span>
                        </div>
                        <i id="icon-historia-clinica" class="fas fa-chevron-down text-xl text-white transform transition-transform duration-300 rotate-180"></i>
                    </button>

                    <div id="content-historia-clinica" class="px-8 py-8 bg-white dark:bg-gray-800 hidden">
                        <div class="space-y-8">
                            <!-- Antecedentes Personales Patológicos -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-notes-medical text-red-500 mr-2"></i>
                                    Antecedentes Personales Patológicos
                                </label>
                                <textarea id="antecedentes_personales" name="antecedentes_personales" rows="3" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Ej.: Diabetes tipo 2, hipertensión, asma, etc."></textarea>
                            </div>

                            <!-- Antecedentes Quirúrgicos -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-cut text-blue-500 mr-2"></i>
                                    Antecedentes Quirúrgicos
                                </label>
                                <textarea id="antecedentes_quirurgicos" name="antecedentes_quirurgicos" rows="3" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Ej.: Cirugías previas como apendicectomía, cesárea, etc."></textarea>
                            </div>

                            <!-- Antecedentes Familiares -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-users text-purple-500 mr-2"></i>
                                    Antecedentes Familiares
                                </label>
                                <textarea id="antecedentes_familiares" name="antecedentes_familiares" rows="3" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Enfermedades hereditarias (padres, abuelos, hermanos)."></textarea>
                            </div>

                            <!-- Alergias -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                                    Alergias
                                </label>
                                <textarea id="alergias" name="alergias" rows="2" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Ej.: Penicilina, mariscos, polvo, etc."></textarea>
                            </div>

                            <!-- Medicamentos Actuales -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-pills text-green-500 mr-2"></i>
                                    Medicamentos Actuales
                                </label>
                                <textarea id="medicamentos_actuales" name="medicamentos_actuales" rows="3" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Nombre, dosis y frecuencia. Ej.: Losartán 50mg diario."></textarea>
                            </div>

                            <!-- Hábitos Tóxicos -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-smoking text-orange-500 mr-2"></i>
                                    Hábitos Tóxicos o Perjudiciales
                                </label>
                                <input type="text" id="habitos_toxicos" name="habitos_toxicos" maxlength="200" value="ninguno" 
                                       class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                       placeholder="Ej.: Tabaco, alcohol, drogas, sedentarismo, etc.">
                            </div>

                            <!-- Vacunas -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-syringe text-blue-500 mr-2"></i>
                                    Vacunas
                                </label>
                                <textarea id="vacunas" name="vacunas" rows="2" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Vacunas importantes recibidas. Ej.: COVID-19, influenza, etc."></textarea>
                            </div>

                            <!-- Antecedentes Gineco-obstétricos -->
                            <div class="space-y-2">
                                <label class="block text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center">
                                    <i class="fas fa-female text-pink-500 mr-2"></i>
                                    Antecedentes Gineco-obstétricos
                                </label>
                                <textarea id="antecedentes_gineco_obstetricos" name="antecedentes_gineco_obstetricos" rows="3" 
                                          class="w-full p-4 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 dark:bg-gray-700 dark:text-white transition-all duration-300 shadow-md hover:shadow-lg" 
                                          placeholder="Solo en mujeres. Ej.: menarquia, embarazos, anticonceptivos."></textarea>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Solo aplicable para pacientes femeninas.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones del Modal -->
                <div class="flex justify-end space-x-6 pt-8 border-t-2 border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="cerrarModalPaciente()" 
                            class="px-8 py-4 text-gray-700 dark:text-gray-300 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-600 dark:to-gray-700 hover:from-gray-300 hover:to-gray-400 dark:hover:from-gray-500 dark:hover:to-gray-600 rounded-xl transition-all duration-300 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center">
                        <i class="fas fa-times mr-2"></i>
                        Cancelar
                    </button>
                    <button type="submit" 
                            class="px-8 py-4 text-white bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 rounded-xl transition-all duration-300 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 flex
